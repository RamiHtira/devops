pipeline {
/*
environment {
		DOCKERHUB_CREDENTIALS=credentials('dockerhub')
	}
*/
agent any
    stages{
        
        stage(' GIT'){
         steps {
            echo 'Pulling...';
            git branch: 'fournisseurs',credentialsId: 'gittoken', url: 'https://github.com/RamiHtira/devops.git'
               }
        }
 	
        stage('Clean'){
            steps {
    
            sh "mvn clean"
               }
            
        }
       stage('Compile'){
            steps {
    
            sh "mvn compile"
               }
            
        }
        stage('Test'){
            steps {
    
            sh "mvn test"
               }
            
        }
        stage('Sonar'){
            steps {
            withSonarQubeEnv( installationName: 'sonar'){
            sh 'mvn sonar:sonar -Dsonar.login=c29e6c4d19417afa72eca2c14b6e5a2039546c44'}
                  }
                  }
         } 
        stage ("Nexuspackage"){
			steps{
			sh "mvn package"
			

                       
            }
	   
        }
	
	stage ("Nexusdeploy"){
	steps{
	sh "mvn deploy"

	}
	}
		    stage('Build image') {
            steps{
            script{
            dockerImage = docker.build("amineouerghi/devops:latest")
            }
            }
        }
        stage('Dockerhub Login') {

			steps {
				sh 'docker login -u $DOCKERHUB_CREDENTIALS_USR -p $DOCKERHUB_CREDENTIALS_PSW'
			}
		}
        
        
        stage('Push') {

			steps {
				sh 'docker push amineouerghi/devops:latest'
		          	}
	         }


    }
         
    }

